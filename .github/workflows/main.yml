# GitHub Actions 工作流：微信消息自动推送
# 功能：每天早上自动运行程序，向指定微信用户推送消息
name: 微信消息自动推送

# 触发条件：定时触发和手动触发
on:
  # 定时触发：每天北京时间早上7点运行
  # 注意：GitHub Actions使用UTC时间，UTC+8小时=北京时间
  schedule:
    - cron: '50 0 * * *'  # UTC时间23点 = 北京时间早上7点
  
  # 手动触发：允许在GitHub网页上手动运行工作流
  workflow_dispatch:
    # 手动触发时的输入选项（可选）
    inputs:
      reason:
        description: '手动运行原因'
        required: false
        default: '测试或临时运行'

# 工作流作业配置
jobs:
  # 单个作业：推送微信消息
  push-weixin-message:
    # 运行环境：最新版Ubuntu Linux
    runs-on: ubuntu-latest
    
    # 作业步骤
    steps:
      # 1. 检出代码仓库
      - name: 检出代码
        uses: actions/checkout@v4  # 使用最新版的checkout action
      
      # 2. 设置Python环境
      - name: 设置Python版本
        uses: actions/setup-python@v5  # 使用最新版的setup-python action
        with:
          python-version: '3.11'  # 指定Python版本（推荐使用稳定版）
      
      # 3. 设置时区为上海时区
      - name: 设置时区
        run: |
          # 将上海时区文件复制到系统时区位置
          sudo cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
          # 更新时区配置文件
          echo "Asia/Shanghai" | sudo tee /etc/timezone
          # 验证时区设置
          date
      
      # 4. 安装依赖包
      - name: 安装Python依赖
        run: |
          # 更新pip
          python -m pip install --upgrade pip
          # 安装requirements.txt中列出的所有依赖
          pip install -r requirements.txt
      
      # 5. 运行微信推送程序
      - name: 运行微信推送程序
        run: |
          # 执行main.py脚本
          python main.py
        
      # 6. （可选）发送运行结果通知（如果需要的话）
      - name: 通知运行结果
        if: always()  # 无论前面步骤是否成功都执行
        run: |
          echo "微信消息推送程序运行完成"
          echo "运行状态：${{ job.status }}"
